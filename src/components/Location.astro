---
import siteData from '../data/site.json';

const { coordinates, address, transit } = siteData;
const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address.full)}`;

// OpenStreetMap embed URL - using the coordinates from the data
const osmEmbedUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${coordinates.lng - 0.005}%2C${coordinates.lat - 0.003}%2C${coordinates.lng + 0.005}%2C${coordinates.lat + 0.003}&layer=mapnik&marker=${coordinates.lat}%2C${coordinates.lng}`;
---

<section class="location section section--alt" aria-labelledby="location-title" id="location">
  <div class="container">
    <h2 id="location-title" class="section__title">Find Us</h2>
    
    <div class="location__content">
      <div class="location__info">
        <div class="location__address">
          <h3 class="location__label">Address</h3>
          <p class="location__text">
            {address.full}
            <br />
            <span class="location__cross-streets">({address.crossStreets})</span>
          </p>
          <a 
            href={mapsUrl}
            class="btn btn--outline location__directions"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="Get directions on Google Maps (opens in new tab)"
          >
            Get Directions â†’
          </a>
        </div>
        
        <div class="location__transit">
          <h3 class="location__label">Getting Here</h3>
          <ul class="location__transit-list" role="list">
            {transit.map((item: { line: string; station: string }) => (
              <li class="location__transit-item">
                <span class="location__transit-line">{item.line}</span>
                <span class="location__transit-station">{item.station}</span>
              </li>
            ))}
          </ul>
        </div>
      </div>
      
      <div class="location__map-wrapper">
        <iframe 
          class="location__map"
          title="Location of The Quiet Bar on OpenStreetMap"
          src={osmEmbedUrl}
          loading="lazy"
          referrerpolicy="no-referrer"
        ></iframe>
        <a 
          href={`https://www.openstreetmap.org/?mlat=${coordinates.lat}&mlon=${coordinates.lng}#map=17/${coordinates.lat}/${coordinates.lng}`}
          class="location__map-link"
          target="_blank"
          rel="noopener noreferrer"
        >
          View Larger Map
        </a>
      </div>
    </div>
  </div>
</section>

<style>
  .location__content {
    display: grid;
    grid-template-columns: 1fr 1.5fr;
    gap: var(--space-8);
    align-items: start;
  }
  
  .location__info {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
  }
  
  .location__label {
    font-family: var(--font-body);
    font-size: var(--text-sm);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--color-primary);
    margin-bottom: var(--space-3);
  }
  
  .location__text {
    font-size: var(--text-lg);
    color: var(--color-secondary);
    line-height: var(--leading-relaxed);
    margin-bottom: var(--space-4);
  }
  
  .location__cross-streets {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    font-style: italic;
  }
  
  .location__directions {
    display: inline-flex;
    margin-top: var(--space-2);
  }
  
  .location__transit-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }
  
  .location__transit-item {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }
  
  .location__transit-line {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 50px;
    padding: var(--space-1) var(--space-2);
    background-color: var(--color-primary);
    color: var(--color-text-dark);
    font-size: var(--text-sm);
    font-weight: 700;
    border-radius: var(--radius-sm);
    text-align: center;
  }
  
  .location__transit-station {
    color: var(--color-text);
    font-size: var(--text-sm);
  }
  
  .location__map-wrapper {
    position: relative;
    background-color: var(--color-bg-deep);
    border: 1px solid rgba(201, 162, 39, 0.2);
    border-radius: var(--radius-md);
    overflow: hidden;
  }
  
  .location__map {
    display: block;
    width: 100%;
    height: 400px;
    border: none;
    filter: 
      grayscale(20%) 
      sepia(10%) 
      contrast(95%);
    transition: filter var(--transition-normal);
  }
  
  .location__map:hover {
    filter: 
      grayscale(0%) 
      sepia(0%) 
      contrast(100%);
  }
  
  .location__map-link {
    display: block;
    padding: var(--space-2);
    text-align: center;
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    background-color: var(--color-bg-deep);
    text-decoration: none;
    transition: color var(--transition-fast);
  }
  
  .location__map-link:hover {
    color: var(--color-primary);
  }
  
  @media (max-width: 768px) {
    .location__content {
      grid-template-columns: 1fr;
    }
    
    .location__map-wrapper {
      order: -1;
    }
    
    .location__map {
      height: 280px;
    }
    
    .location__info {
      text-align: center;
    }
    
    .location__transit-list {
      align-items: center;
    }
    
    .location__directions {
      width: 100%;
      justify-content: center;
    }
  }
</style>

